<?php

//=====================================================================================
//======================== N Reine en minisat avec symetrie ===========================
//=====================================================================================

//========================================================
//================== Initialisation ====================== 
//======================================================== 

//on recupere le nombre pour initialiser n, qui est le nombre de reine

$n=$argv[1];

//========================================================
//================= Calcul prealable ===================== 
//========================================================

//On calcule le nombre de clause

$s1=0;
for($i =1;$i<$n;$i++){
	$s1+=$i;
}
$clause=$s1*2*$n+$n*2+2*$s1;
$s1=0;
for($i=2;$i<$n;$i++){
	for($j=1;$j<=$n-$i;$j++){
		$s1+=$j;
	}
}
$clause+=2*2*$s1;
$var=$n*$n;
$var=$n*$n;
$chaine="c algo: $n reine \np cnf $var $clause\n";
$a=0;

//==========================================================
//==================== Remplissage =========================
//==========================================================

//Ligne nreine

for($i=1;$i<=$var;$i++){
	if($i%$n==0){
		$chaine.=$i." 0 \n";
		$a++;
	}
	else{
		$chaine.=$i." ";
	}
}

//========================================================
//========================================================

//collonne nreine

for($i=1;$i<=$n;$i++){
	for($j=$i;$j<=$n*($n-1)+$i;$j+=$n){
		$chaine.="$j ";
		
	}
$chaine.="0 \n";
$a++;
}

//========================================================
//========================================================

//Ligne unicité

$m=1;
for($h=1;$h<=$n*($n-1)+1;$h+=$n){
	for($k=$h;$k<=$n*$m;$k++){
		for($i=$k+1;$i<=$n*$m;$i++){
			$chaine.="-$k -$i 0\n";
			$a++;
		}
	}
$m++;
}

//========================================================
//========================================================

//collone unicité

for($h=1;$h<=$n;$h++){
	for($k=$h;$k<=$n*($n-1)+$h;$k+=$n){
		for($i=$k+$n;$i<=$n*($n-1)+$h;$i+=$n){
			$chaine.="-$k -$i 0\n";
			$a++;
		}
	}
}

//========================================================
//========================================================

//diagonale unicité + diagonale inferieur unicité

$m=1;
for($k=1;$k<$n*($n-1);$k+=$n){
	for($i=$k;$i<$n*($n-1);$i+=$n+1){
		for($j=$i+$n+1;$j<=$var;$j+=$n+1){
			$chaine.="-$i -$j 0\n";
			$a++;
		}
	}
}

//========================================================
//========================================================

//diagonale superieur unicité

$m=0;
for($k=2;$k<$n;$k++){
	for($i=$k;$i<=$n*($n-1)-$n*$m;$i+=$n+1){
		for($j=$i+$n+1;$j<=$n*($n-1)-$n*$m;$j+=$n+1){
			$chaine.="-$i -$j 0\n";
			$a++;
		}
	}
$m++;
}

//========================================================
//========================================================

//diagonale infrieur autre unicité + diagonale unicité

$m=1;
for($k=$n;$k<$var;$k+=$n){
	for($i=$k;$i<$n*($n-1)+$m;$i+=$n-1){
		for($j=$i+$n-1;$j<=$n*($n-1)+$m;$j+=$n-1){
			$chaine.="-$i -$j 0\n";
			$a++;
		}
	
	}
$m++;
}

//========================================================
//========================================================

//diagonale superieur autre unicité

$m=2;
for($k=$n-1;$k>1;$k--){
	for($i=$k;$i<=$n*($n-$m)+1;$i+=$n-1){
		for($j=$i+$n-1;$j<=$n*($n-$m)+1;$j+=$n-1){
			$chaine.="-$i -$j 0\n";
			$a++;
		}
	
	}
$m++;
}

//========================================================
//========================================================

//on rentre le contenus du fichier minisat

$fichier="algo$n"."reine.cnf";
file_put_contents($fichier,$chaine);

//========================================================
//========================================================

//on execute le fichier minisat

$fichieroutput="sortis".$n."nreineminisat.txt";
shell_exec(" minisat $fichier $fichieroutput");

//========================================================
//========================================================

//on recupere le contenus du fichier de sortis

$output = shell_exec("cat $fichieroutput");

//on decoupe ensuite le resultat pour recuperer les chaines de solutions

$taboutput = explode("\n", $output);
$taboutput = explode(" ", $taboutput[1]);

//et on procède à l'affichage du contenus des documents de sortis

$output="";
for($i=0;$i<$var;$i++){
	if(($i+1)%$n==0&&$i!=0){
		if(intval($taboutput[$i])<0){
			$output.="0 \n";	
		}
		else{
			$output.="1 \n";
		}
	}
	else{
		if(intval($taboutput[$i])<0){
			$output.="0 ";	
		}
		else{
			$output.="1 ";
		}
	}
}

//========================================================
//========================================================

echo "$output";

//=====================================================================================
//=====================================================================================
?>
